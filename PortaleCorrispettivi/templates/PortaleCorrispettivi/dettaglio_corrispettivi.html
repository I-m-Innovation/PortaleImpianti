{% extends 'PortaleCorrispettivi/baselayoutcorispettivi.html' %}
{% load static %}

{% block content %}
<main class="home-container">
  <div class="item-c py-3 ps-2 mx-1">
    {% include 'PortaleCorrispettivi/partials/sidebar.html' %}
  </div>

  <div class="item-b">
    <div class="container-fluid pt-3">
      <div class="row p-0 m-0">
        <div class="col corrispettivi-card px-3 pt-3" style="min-width: 80%">
          <img 
            class="sfondo-idroelettrico"
            src="{% static 'images/sfondo_san_teodoro.png' %}"
            alt="sfondo"
          />
          <div class="container" style="margin: auto" data-nickname="{{ nickname }}">
            <div class="report-link mt-3">
              <a class="btn btn-dark" href="{% url 'report-impianto' nickname %}"> Report </a>
            </div>
            <h1 style="color: #4a3c54; font-weight: bold; display: inline">{{ impianto.nome_impianto }}</h1> 
            <p>Misure di energia e situazione dei corrispettivi</p> 

            <!-- passa anni al file js -->
            <script>
              window.anni_disponibili = {{ anni_disponibili|safe }};
              console.log('anni_disponibili:', window.anni_disponibili);
            </script>

            <!-- grafico totale  -->
            <div class="mt-5 mb-4 border rounded p-3 bg-light">
              <h4 class="mb-3 text-primary">Andamento complessivo - {{ impianto.nome_impianto }}</h4>
              <div class="row">
                  <div class="col-lg-7 col-md-12">
                      <div id="chart_totale_impianto" style="width:100%; height:450px;"></div>
                  </div>
                  <div class="col-lg-5 col-md-12">
                      <div class="table-responsive" style="max-height: 450px; overflow-y: auto;">
                          <table id="tabella_totale_impianto" class="table table-sm table-bordered table-hover" style="font-size: 0.85rem;">
                              <thead class="table-primary sticky-top">
                                  <tr>
                                      <th class="text-center" style="padding: 0.4rem 0.1rem; font-size: 0.8rem; width: 60px; vertical-align: middle;">Periodo</th>
                                      <th class="text-center" style="padding: 0.4rem 0.1rem; font-size: 0.8rem; width: 60px; vertical-align: middle;">Energia<br><small>(kWh)</small></th>
                                      <th class="text-center" style="padding: 0.4rem 0.1rem; font-size: 0.8rem; width: 60px; vertical-align: middle;">Corrisp.<br><small>(€)</small></th>
                                      <th class="text-center" style="padding: 0.4rem 0.1rem; font-size: 0.8rem; width: 60px; vertical-align: middle;">Fattur.<br><small>(€)</small></th>
                                      <th class="text-center" style="padding: 0.4rem 0.1rem; font-size: 0.8rem; width: 60px; vertical-align: middle;">Incassi<br><small>(€)</small></th>
                                  </tr>
                              </thead>
                              <tbody style="font-size: 0.8rem;">
                                  <!-- qui vengono inseriti i dati js -->
                              </tbody>
                          </table>
                      </div>
                  </div>
              </div>
          </div>

            <script src="https://code.highcharts.com/highcharts.js"></script>
            <script src="https://code.highcharts.com/modules/exporting.js"></script>
            <script src="https://code.highcharts.com/modules/export-data.js"></script>
            <script src="https://code.highcharts.com/modules/accessibility.js"></script>

            <hr class="my-5">

            {% for anno in anni_disponibili %}
              {% include 'PortaleCorrispettivi/partials/scheda_corrispettivi.html' %}
            {% endfor %}

            {% if nickname == 'ponte_giurino' %}
              {% include 'PortaleCorrispettivi/dettaglio_corrispettivi_tabella-consorzi_js.html' %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}

{% block extra_scripts %}
  <script src="{% static 'js/tabellacorrispettivi.js' %}"></script>
  <script src="{% static 'js/grafico_totale_impianto.js' %}"></script>
  <script src="{% static 'js/graficocorrispettivi.js' %}"></script>
  <script src="{% static 'js/tabellamisure.js' %}"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      inizializzaTabellaLetture("{{ anno }}", "{{ nickname }}");
    });
  </script>
{% endblock %}